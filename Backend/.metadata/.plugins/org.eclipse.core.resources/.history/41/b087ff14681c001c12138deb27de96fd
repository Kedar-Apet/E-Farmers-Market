package com.app.service;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import javax.transaction.Transactional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.app.dao.CropRepository;
import com.app.dao.UserRepository;
import com.app.pojos.Crop;
import com.app.pojos.User;
@Transactional
@Service
public class CropServiceImpl implements ICropService {
@Autowired
private CropRepository cropRepo;
@Autowired
private UserRepository userRepo;

	@Override
	public List<Crop> getAllCropsByUserId(int id) {
		
	
		List<Crop> allCrops = cropRepo.findByUsers_Id(id);
	
		//allCrops.forEach(c->System.out.println(c.getUsers()));
		return allCrops;
	}

	@Override
		public Crop addCrop(Crop newCrop, int id) {
			User user=userRepo.getById(id);
			Set<User> users=new HashSet<>();
			users.add(user);
			newCrop.setUsers(users);
			newCrop.setStatus(0);
			cropRepo.save(newCrop);
			System.out.println(newCrop.getUsers());
			return newCrop;
		}
	@Override
		public String deleteCrop(int id) {
		Crop crop=cropRepo.getById(id);
		crop.setStatus(1);
		cropRepo.save(crop);
			return "Deleted by Id"+id;
		}
	
	@Override
		public Crop cropDetails(int id) {
			System.out.println(cropRepo.getById(id));
			return cropRepo.getById(id);
		}
	
	@Override
		public Crop updateDetails(Crop detachedCrop,int id) {
		Crop existingCrop  =cropRepo.getById(id);
		existingCrop.setDateOfUpload(detachedCrop.getDateOfUpload());
		existingCrop.setPrice(detachedCrop.getPrice());
		existingCrop.setQuantity(existingCrop.getQuantity());
			return cropRepo.save(existingCrop);
		}
	
	@Override
		public List<Crop> getCrops() {
		 List<Crop> crops = new ArrayList<Crop>();
			cropRepo.findAll().forEach(crop->{
				System.out.println(crop.getStatus());
			if(crop.getStatus()==0)
			crops.add(crop);
			});
			 
			 return crops;
		}

}
